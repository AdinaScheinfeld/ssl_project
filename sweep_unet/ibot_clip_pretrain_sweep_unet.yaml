# sweep_unet/ibot_clip_pretrain_sweep_unet.yaml
# Mirrors your Swin sweep, but adds UNet-architecture knobs.

program: /home/ads4015/ssl_project/sweep_unet/run_pretrain_wandb_unet.py
name: ibot-clip-pretrain-lsm-sweep-unet
project: ibot-clip-pretrain-lsm-all-unet

method: bayes
metric:
  name: val_loss_report
  goal: minimize

parameters:
  training.max_epochs:
    values: [500, 1000, 2000]
  training.patience:
    values: [50, 100, 200]

  dist.accumulate_grad_batches:
    values: [1, 4, 8]

  data.global_batch_size:
    values: [2, 4, 8]
  data.num_workers:
    values: [0, 1]
  data.downsample.enabled:
    values: [true, false]

  model.mask_ratio_warmup:
    values: [0.05, 0.1]
  model.warmup_epochs:
    values: [20, 30, 50]
  model.ema_decay:
    values: [0.994, 0.996, 0.998]
  model.mask_patch_size:
    values: [4, 8, 16]
  model.temp_student:
    values: [0.025, 0.05, 0.1]
  model.temp_teacher:
    values: [0.025, 0.05, 0.1]
  model.embed_dim:
    values: [128, 256, 512]
  model.clip_temperature:
    values: [0.04, 0.07, 0.1]

  # --- UNet architecture sweep knobs ---
  model.unet.channels:
    values:
      - [16, 32, 64, 128]
      # - [16, 32, 64, 128, 256]
      # - [32, 64, 128, 256, 512]
  model.unet.num_res_units:
    values: [2]
    # values: [1, 2, 3]
  model.unet.norm:
    values: ["INSTANCE"]
    # values: ["INSTANCE", "BATCH"]


  # For channels length 5, strides must be length 4 (monai Unet)
  model.unet.strides:
    values:
      - [2, 2, 2]
      # - [2, 2, 2, 2]
      # - [2, 2, 2, 1]

  # loss weights (match your Swin sweep ranges)
  loss_weights.clip_weight:
    distribution: uniform
    min: 0.15
    max: 0.60
  loss_weights.align_weight:
    distribution: uniform
    min: 0.02
    max: 0.12
  loss_weights.reconstruction_weight:
    distribution: uniform
    min: 0.15
    max: 0.40
  loss_weights.distill_weight:
    distribution: uniform
    min: 0.20
    max: 0.50

early_terminate:
  type: hyperband
  min_iter: 15

